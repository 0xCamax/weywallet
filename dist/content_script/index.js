(()=>{var p=document.createElement("script");p.src=chrome.runtime.getURL("content_script/injected/index.js");p.type="text/javascript";(document.head||document.documentElement).appendChild(p);var T="test";var C=[{id:"0x66eee",name:"Arbitrum Sepolia",nativeCurrency:{name:"Arbitrum Sepolia Ether",symbol:"ETH",decimals:18},rpcUrl:"https://sepolia-rollup.arbitrum.io/rpc"},{id:"0x14a34",name:"Base Sepolia",nativeCurrency:{name:"Sepolia Ether",symbol:"ETH",decimals:18},rpcUrl:"https://sepolia.base.org"},{id:"0xaa36a7",name:"Sepolia",nativeCurrency:{name:"Sepolia Ether",symbol:"ETH",decimals:18},rpcUrl:"https://sepolia.drpc.org"},{id:"0xaa37dc",name:"OP Sepolia",nativeCurrency:{name:"Sepolia Ether",symbol:"ETH",decimals:18},rpcUrl:"https://sepolia.optimism.io"}],y=T=="test"?C:[{id:"0xa4b1",name:"Arbitrum",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrl:"https://arb1.arbitrum.io/rpc",tokens:{link:"0xf97f4df75117a78c1A5a0DBb814Af92458539FB4"},contracts:{CCIPDirectory:{router:"0x141fa059441E0ca23ce184B6A78bafD2A517DdE8"},AutomationDirectory:{registry:"0x37D9dC70bfcd8BC77Ec2858836B923c560E891D1",registrar:"0x86EFBD0b6736Bed994962f9797049422A3A8E8Ad"}}},{id:"0x2105",name:"Base",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrl:"https://mainnet.base.org",tokens:{link:"0x88Fb150BDc53A65fe94Dea0c9BA0a6dAf8C6e196"},contracts:{CCIPDirectory:{router:"0x881e3A65B4d4a04dD529061dd0071cf975F58bCD"},AutomationDirectory:{registry:"0xf4bAb6A129164aBa9B113cB96BA4266dF49f8743",registrar:"0xE28Adc50c7551CFf69FCF32D45d037e5F6554264"}}},{id:"0xa",name:"OP Mainnet",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrl:"https://mainnet.optimism.io",tokens:{link:"0x350a791Bfc2C21F9Ed5d10980Dad2e2638ffa7f6",WETH:"0x4200000000000000000000000000000000000006"},contracts:{CCIPDirectory:{router:"0x3206695CaE29952f4b0c22a169725a865bc8Ce0f"},AutomationDirectory:{registry:"0x4F70c323b8B72AeffAF633Aa4D5e8B6Be5df4AEf",registrar:"0xe96057F85510292231e2C759752f012C87A8c8dd"}}}],S=T=="test"?"0x14a34":"0x2105",x=y.find(u=>u.id==S)??{name:"base",id:"0x2105",rpcUrl:"https://mainnet.base.org"};var d=class extends EventTarget{id=0;chains=new Map;current={id:"",name:"",rpcUrl:""};constructor(e){super(),e.forEach(t=>this.chains.set(t.id,t)),this.current=e[0]}changeChain(e){let t=this.chains.get(e);if(!t)throw new Error(`Chain not supported: ${e}`);this.current=t}addChain(e){this.chains.set(e.id,e)}url(){return this.current.rpcUrl}on(e,t){this.addEventListener(e,t)}off(e,t){this.removeEventListener(e,t)}emit(e,t){this.dispatchEvent(new CustomEvent(e,{detail:t}))}async request(e,t=[]){let r={jsonrpc:"2.0",method:e,params:t,id:this.id++},i=await(await fetch(this.url(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).json();if(i.error)throw new Error(`[${i.error.code}] ${i.error.message}`);return i.result}web3_sha3(e){return this.request("web3_sha3",[e])}net_version(){return this.request("net_version")}net_listening(){return this.request("net_listening")}net_peerCount(){return this.request("net_peerCount")}eth_protocolVersion(){return this.request("eth_protocolVersion")}eth_syncing(){return this.request("eth_syncing")}eth_coinbase(){return this.request("eth_coinbase")}eth_mining(){return this.request("eth_mining")}eth_hashrate(){return this.request("eth_hashrate")}eth_gasPrice(){return this.request("eth_gasPrice")}eth_accounts(){return this.request("eth_accounts")}eth_blockNumber(){return this.request("eth_blockNumber")}eth_getBalance(e,t="latest"){return this.request("eth_getBalance",[e,t])}eth_getStorageAt(e,t,r="latest"){return this.request("eth_getStorageAt",[e,t,r])}eth_getTransactionCount(e,t="latest"){return this.request("eth_getTransactionCount",[e,t])}eth_getBlockTransactionCountByHash(e){return this.request("eth_getBlockTransactionCountByHash",[e])}eth_getBlockTransactionCountByNumber(e){return this.request("eth_getBlockTransactionCountByNumber",[e])}eth_getCode(e,t="latest"){return this.request("eth_getCode",[e,t])}eth_sendRawTransaction(e){return this.request("eth_sendRawTransaction",[e])}eth_call(e,t="latest"){return this.request("eth_call",[e,t])}eth_estimateGas(e){return this.request("eth_estimateGas",[e])}eth_feeHistory(e="0xa",t="latest",r=[50]){return this.request("eth_feeHistory",[e,t,r])}eth_getBlockByHash(e,t=!1){return this.request("eth_getBlockByHash",[e,t])}eth_getBlockByNumber(e,t=!1){return this.request("eth_getBlockByNumber",[e,t])}eth_getTransactionByHash(e){return this.request("eth_getTransactionByHash",[e])}eth_getTransactionByBlockHashAndIndex(e,t){return this.request("eth_getTransactionByBlockHashAndIndex",[e,t])}eth_getTransactionByBlockNumberAndIndex(e,t){return this.request("eth_getTransactionByBlockNumberAndIndex",[e,t])}eth_getTransactionReceipt(e){return this.request("eth_getTransactionReceipt",[e])}eth_getLogs(e){return this.request("eth_getLogs",[e])}eth_newFilter(e){return this.request("eth_newFilter",[e])}eth_newBlockFilter(){return this.request("eth_newBlockFilter")}eth_newPendingTransactionFilter(){return this.request("eth_newPendingTransactionFilter")}eth_uninstallFilter(e){return this.request("eth_uninstallFilter",[e])}eth_getFilterChanges(e){return this.request("eth_getFilterChanges",[e])}eth_getFilterLogs(e){return this.request("eth_getFilterLogs",[e])}eth_createAccessList(e,t="latest"){return this.request("eth_createAccessList",[e,t])}async populateTransaction(e,t){let r,s=[],i=e.type??"0x0";if(t&&(e.from=t),i==="0x0"||i==="0x1"){let{gasLimit:n,gasPrice:a}=await this.estimateGas(e);r={gasLimit:n,gasPrice:a}}else if(i==="0x2")e.accessList=(await this.eth_createAccessList(e)).accessList;else{let{gasLimit:n,maxFeePerGas:a,maxPriorityFeePerGas:c}=await this.estimateGas(e);r={gasLimit:n,maxFeePerGas:a,maxPriorityFeePerGas:c}}let o=await this.eth_getTransactionCount(e.from);return{...e,...r,accessList:s,nonce:o=="0x0"?"":o}}async estimateGas(e){let t=await this.eth_estimateGas(e),r=BigInt(t);r=r+r/5n;let s,i,o;try{let n=await this.eth_feeHistory(),a=n&&n.baseFeePerGas&&n.baseFeePerGas.length>0?BigInt(n.baseFeePerGas[0]):0n,c=n&&n.reward&&n.reward.length>0&&n.reward[0].length>0?BigInt(n.reward[0][0]):1500000000n;o=await this.eth_gasPrice(),i="0x"+c.toString(16),s="0x"+(a+c*2n).toString(16)}catch{s=await this.eth_gasPrice(),i="0x59682f00"}return{gasPrice:o,gasLimit:"0x"+r.toString(16),maxFeePerGas:s,maxPriorityFeePerGas:i}}};var l=new d(y);async function E({method:u,params:e}){switch(u){case"eth_blockNumber":return await l.eth_blockNumber();case"eth_chainId":return l.current.id;case"eth_getBalance":return await l.eth_getBalance(e[0]);case"eth_getTransactionCount":return await l.eth_getTransactionCount(e[0]);case"eth_getCode":return await l.eth_getCode(e[0]);case"eth_getStorageAt":return await l.eth_getStorageAt(e[0],e[1]);case"eth_getBlockByNumber":return await l.eth_getBlockByNumber(e[0]);case"eth_getTransactionByHash":return await l.eth_getTransactionByHash(e[0]);case"eth_getTransactionReceipt":return await l.eth_getTransactionReceipt(e[0]);case"eth_getLogs":return await l.eth_getLogs(e[0]);case"eth_estimateGas":return await l.eth_estimateGas(e[0]);case"eth_call":return await l.eth_call(e[0]);case"eth_feeHistory":return await l.eth_feeHistory(e[0],e[1]);default:throw new Error(`Method ${u} is recognized but not implemented.`)}}async function b(){let u={active:!0,lastFocusedWindow:!0},[e]=await chrome.tabs.query(u);return e.id}var m=class{source;listeners;constructor(e){this.source=e,this.listeners=new Map,globalThis.addEventListener("message",this._internalHandler)}log(...e){console.log(`[${this.source}]`,...e)}listen=(e,t)=>{this.listeners.set(e,t)};unlisten=e=>{this.listeners.delete(e)};send=(e,t={},r,s="*",i={})=>{let o={__mailbox__:!0,type:e,payload:t,source:this.source,dest:r,...i};this.source==="DOM"||this.source==="CONTENT SCRIPT"&&r!=="BACKGROUND"?globalThis.postMessage(o,s):r==="CONTENT SCRIPT"&&this.source!=="DOM"?b().then(n=>chrome.tabs.sendMessage(n,o,()=>this.log(`${e} send`))):chrome.runtime.sendMessage(o)};_internalHandler=e=>{if(!e.data||e.data.__mailbox__!==!0||e.data.source===this.source||e.data.dest!==this.source)return;this.log("Message accepted");let t=this.listeners.get(e.data.type);typeof t=="function"&&t(e.data.payload,e)}};var _=class extends m{pending;handlers;constructor(e){super(e),this.source=e,this.pending=new Map,this.handlers=new Map,globalThis.addEventListener("message",this._onglobalThisMessage.bind(this)),(e==="CONTENT SCRIPT"||e==="BACKGROUND"||e==="EXTENSION")&&chrome.runtime.onMessage.addListener((t,r,s)=>this._onRuntimeMessage(t,r,s))}_onglobalThisMessage(e){if(e.data.source===this.source||!e.data?.__mailbox__)return;this.log(e);let{source:t,type:r,payload:s,dest:i,requestId:o}=e.data,{data:n}=s;if(!(t===this.source||i!==this.source)){if(r?.startsWith("RESPONSE_")&&this.pending.has(o)){let a=this.pending.get(o);a&&(a.resolve(n),this.pending.delete(o));return}if(r?.startsWith("REQUEST_")){let a=r.replace("REQUEST_",""),c=this.handlers.get(a);if(!c){this.log(`No handler for request: ${a}`);return}Promise.resolve(c(s,e)).then(g=>{this.send(`RESPONSE_${r}`,g,"DOM","*",{requestId:o})})}if(r?.startsWith("NOTIFY_")){let a=r.replace("NOTIFY_",""),c=this.handlers.get(a);if(!c){this.log("No handler for this");return}c(s,a)}}}_onRuntimeMessage(e,t,r){if(!e?.__mailbox__||e.dest!==this.source)return this.log("Ignored runtime message"),!1;let{type:s,requestId:i,payload:o}=e;if(s?.startsWith("REQUEST_")){let n=s.replace("REQUEST_",""),a=this.handlers.get(n);if(!a)return r({ok:!1,error:`No handler for ${n}`}),!1;try{let c=a(o,t,r);return c&&typeof c.then=="function"?(c.then(g=>{this.log("Handler resolved with:",g),r({__mailbox__:!0,source:this.source,dest:e.source,requestId:i,type:`RESPONSE_${n}`,payload:g,ok:!0})}).catch(g=>{this.log("Handler rejected with:",g.message),r({ok:!1,error:g?.message||String(g)})}),!0):!1}catch(c){let g=c;return r({ok:!1,error:g?.message||String(g)}),!1}}return s?.startsWith("NOTIFY_")&&this.source==="CONTENT SCRIPT"?(this.send(s,o,"DOM"),!1):!0}request(e,t,r){let s=t?.method+"_"+crypto.randomUUID();return new Promise(i=>{this.pending.set(s,{resolve:i});let o={__mailbox__:!0,type:`REQUEST_${e}`,payload:t,requestId:s,source:this.source,dest:r};r==="BACKGROUND"||r==="EXTENSION"?chrome.runtime.sendMessage(o,n=>{if(chrome.runtime.lastError){console.error("No extension page open:",chrome.runtime.lastError.message);return}let a=this.pending.get(s);a&&(a.resolve(n),this.pending.delete(s))}):this.send(`REQUEST_${e}`,t,r,"*",{requestId:s})})}on(e,t){this.handlers.set(e,t),this.log("Registered handler for",e)}off(e){this.handlers.delete(e),this.log("Removed handler for",e)}};var h={PROVIDER:"eip6963:requestProvider",ACCOUNTS:"eth_accounts",ACCOUNTS2:"eth_requestAccounts",UPGRADE:"upgrade",RSA_SIGN:"rsa_signatureRequest",ECDSA_SIGN:"ecdsa_signatureRequest",ETH_SIGN:"eth_sign",ETH_SEND:"eth_sendTransaction",PERSONAL_SIGN:"personal_sign",SIGN_TYPED_V1:"eth_signTypedData_v1",SIGN_TYPED_V3:"eth_signTypedData_v3",SIGN_TYPED_V4:"eth_signTypedData_v4",SEND_RAW_TX:"eth_sendRawTransaction",ACTION:"model_action"};var f=new Set([h.ACCOUNTS2,h.ACCOUNTS,h.ETH_SIGN,h.PERSONAL_SIGN,h.SEND_RAW_TX,h.SIGN_TYPED_V1,h.SIGN_TYPED_V3,h.SIGN_TYPED_V4,h.RSA_SIGN,h.ECDSA_SIGN,h.UPGRADE,h.PROVIDER,h.ETH_SEND]);var B=new _("CONTENT SCRIPT");B.on("WALLET",async(u,e)=>{try{let{method:t}=u;if(f.has(t)){let r=await B.request(t,u,"BACKGROUND"),{payload:s,ok:i}=r;return i?s:"No response from wallet"}else return{data:await E(u)}}catch(t){console.error(t)}});})();
